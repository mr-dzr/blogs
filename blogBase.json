{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "pinyin", "script": "", "style": "", "head": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 1, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "allHead": "", "title": "Blog Title", "subTitle": "Blog description", "avatarUrl": "https://github.githubassets.com/favicons/favicon.svg", "GMEEK_VERSION": "last", "postListJson": {"P1": {"htmlDir": "docs/post/Nginx -cong-an-zhuang-dao-gao-ke-yong-\uff0c-yi-pian-gao-ding.html", "labels": ["documentation"], "postTitle": "Nginx \u4ece\u5b89\u88c5\u5230\u9ad8\u53ef\u7528\uff0c\u4e00\u7bc7\u641e\u5b9a", "postUrl": "post/Nginx%20-cong-an-zhuang-dao-gao-ke-yong-%EF%BC%8C-yi-pian-gao-ding.html", "postSourceUrl": "https://github.com/mr-dzr/blogs/issues/1", "commentNum": 0, "wordCount": 18130, "description": "\u67b6\u6784\u6587\u6458 2022-01-23 12:57\n\n## \u4e00\u3001Nginx \u5b89\u88c5\n\n### 1\u3001\u53bb\u5b98\u7f51[http://nginx.org/\u4e0b\u8f7d\u5bf9\u5e94\u7684 nginx](http://nginx.org/%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84nginx)\u5305\uff0c\u63a8\u8350\u4f7f\u7528\u7a33\u5b9a\u7248\u672c\n\n### 2\u3001\u4e0a\u4f20 nginx \u5230 linux \u7cfb\u7edf\n\n### 3\u3001\u5b89\u88c5\u4f9d\u8d56\u73af\u5883\n\n#### (1)\u5b89\u88c5 gcc \u73af\u5883\n\n```shell\nyum install gcc-c++\n```\n\n#### (2)\u5b89\u88c5 PCRE \u5e93\uff0c\u7528\u4e8e\u89e3\u6790\u6b63\u5219\u8868\u8fbe\u5f0f\n\n```shell\nyum install -y pcre pcre-devel\n```\n\n#### (3)zlib \u538b\u7f29\u548c\u89e3\u538b\u7f29\u4f9d\u8d56\n\n```shell\nyum install -y zlib zlib-devel\n```\n\n#### (4)SSL \u5b89\u5168\u7684\u52a0\u5bc6\u7684\u5957\u63a5\u5b57\u534f\u8bae\u5c42\uff0c\u7528\u4e8e HTTP \u5b89\u5168\u4f20\u8f93\uff0c\u4e5f\u5c31\u662f https\n\n```shell\nyum install -y openssl openssl-devel\n```\n\n### 4\u3001\u89e3\u538b\uff0c\u9700\u8981\u6ce8\u610f\uff0c\u89e3\u538b\u540e\u5f97\u5230\u7684\u662f\u6e90\u7801\uff0c\u6e90\u7801\u9700\u8981\u7f16\u8bd1\u540e\u624d\u80fd\u5b89\u88c5\n\n```shell\ntar -zxvf nginx-1.16.1.tar.gz\n```\n\n### 5\u3001\u7f16\u8bd1\u4e4b\u524d\uff0c\u5148\u521b\u5efa nginx \u4e34\u65f6\u76ee\u5f55\uff0c\u5982\u679c\u4e0d\u521b\u5efa\uff0c\u5728\u542f\u52a8 nginx \u7684\u8fc7\u7a0b\u4e2d\u4f1a\u62a5\u9519\n\n```shell\nmkdir /var/temp/nginx -p\n```\n\n### 6\u3001\u5728 nginx \u76ee\u5f55\uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u914d\u7f6e\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u521b\u5efa makefile \u6587\u4ef6\n\n```shell\n./configure\n--prefix=/usr/local/nginx\n--pid-path=/var/run/nginx/nginx.pid\n--lock-path=/var/lock/nginx.lock\n--error-log-path=/var/log/nginx/error.log\n--http-log-path=/var/log/nginx/access.log\n--with-http_gzip_static_module\n--http-client-body-temp-path=/var/temp/nginx/client\n--http-proxy-temp-path=/var/temp/nginx/proxy\n--http-fastcgi-temp-path=/var/temp/nginx/fastcgi\n--http-uwsgi-temp-path=/var/temp/nginx/uwsgi\n--http-scgi-temp-path=/var/temp/nginx/scgi\n```\n\n\u6ce8\uff1a\u4ee3\u8868\u5728\u547d\u4ee4\u884c\u4e2d\u6362\u884c\uff0c\u7528\u4e8e\u63d0\u9ad8\u53ef\u8bfb\u6027\u914d\u7f6e\u547d\u4ee4\uff1a\n\n|              \u547d\u4ee4              |                  \u89e3\u91ca                  |\n| :----------------------------: | :------------------------------------: |\n|            --prefix            |            \u6307\u5b9a nginx \u76ee\u5f55             |\n|           --pid-path           |           \u6307\u5b9a nginx \u7684 pid            |\n|          --lock-path           |   \u9501\u5b9a\u5b89\u88c5\u6587\u4ef6\uff0c\u9632\u6b62\u6076\u610f\u7be1\u6539\u6216\u8bef\u64cd\u4f5c   |\n|        --error-log-path        |              \u9519\u8bef\u65e5\u5fd7\u76ee\u5f55              |\n|        --http-log-path         |                  \u65e5\u5fd7                  |\n| --with-http_gzip_static_module | \u542f\u7528 gzip \u6a21\u5757\uff0c\u5728\u7ebf\u5b9e\u65f6\u538b\u7f29\u8f93\u51fa\u6570\u636e\u6d41 |\n|  --http-client-body-temp-path  |         \u8bbe\u7f6e\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e34\u65f6\u76ee\u5f55         |\n|     --http-proxy-temp-path     |         \u8bbe\u7f6e http \u4ee3\u7406\u4e34\u65f6\u76ee\u5f55         |\n|    --http-fastcgi-temp-path    |          \u8bbe\u7f6e fastcg \u4e34\u65f6\u76ee\u5f55          |\n|     --http-uwsgi-temp-path     |          \u8bbe\u5b9a uwsgi \u4e34\u65f6\u76ee\u5f55           |\n|     --http-scgi-temp-path      |           \u8bbe\u7f6e scgi \u4e34\u65f6\u76ee\u5f55           |\n\n7\u3001make \u7f16\u8bd1&\u5b89\u88c5\n\n```shell\nmake\nmake install\n```\n\n### 8\u3001\u8fdb\u5165 sbin \u76ee\u5f55\u542f\u52a8 nginx\n\n```shell\n\u542f\u52a8\uff1anginx\n\u505c\u6b62\uff1a./nginx -s stop\n\u91cd\u65b0\u52a0\u8f7d\uff1a./nginx -s reload\n```\n\n## \u4e8c\u3001\u914d\u7f6e\u53cd\u5411\u4ee3\u7406\n\n### 1\u3001\u914d\u7f6e upstream\n\n```shell\nupstream [proxyName] {\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n```\n\n### 2\u3001\u914d\u7f6e server\n\n```shell\nserver {\n    listem  80;\n    server_name www.tomcats.com;    location / {\n        proxy_pass http://tomcats;\n    }\n}\n```\n\n## \u4e09\u3001\u914d\u7f6e\u8d1f\u8f7d\u5747\u8861\n\nnginx \u9ed8\u8ba4\u91c7\u7528\u8f6e\u8bad\u7684\u65b9\u5f0f\u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\n\n### 1\u3001\u4f7f\u7528\u52a0\u6743\u8f6e\u8be2\n\n```shell\nupstream [proxyName] {\n    server 192.168.1.173:8080 weight=1;\n    server 192.168.1.174:8080 weight=5;\n    server 192.168.1.175:8080 weight=2;\n}\n```\n\n### 2\u3001hash \u8d1f\u8f7d\u5747\u8861\n\n```shell\nupstream [proxyName] {\n    ip_hash\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n```\n\nhash \u7b97\u6cd5\u5b9e\u9645\u4e0a\u53ea\u4f1a\u8ba1\u7b97 192.168.1 \u8fd9\u6bb5\u505a\u54c8\u5e0c\n\n\u4f7f\u7528 ip_hash \u7684\u6ce8\u610f\u70b9\uff1a\n\n\u4e0d\u80fd\u628a\u540e\u53f0\u670d\u52a1\u5668\u76f4\u63a5\u79fb\u9664\uff0c\u53ea\u80fd\u6807\u8bb0 down.\n\n### 3\u3001url hash \u8d1f\u8f7d\u5747\u8861\n\n```shell\nupstream [proxyName] {\n    hash $request_url;\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n```\n\n### 4\u3001\u6700\u5c0f\u8fde\u63a5\u8d1f\u8f7d\u5747\u8861\n\n```shell\nupstream [proxyName] {\n    least_conn;\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n```\n\n## \u56db\u3001upstream \u6307\u4ee4\u53c2\u6570\n\n`max_conns`\uff1a\u9650\u5236\u6700\u5927\u540c\u65f6\u8fde\u63a5\u6570 1.11.5 \u4e4b\u524d\u53ea\u80fd\u7528\u4e8e\u5546\u4e1a\u7248\n\n`slow_start`\uff1a\u5355\u4f4d\u79d2\uff0c\u6743\u91cd\u5728\u6307\u5b9a\u65f6\u95f4\u5185\u4ece 1 \u4e0a\u5347\u5230\u6307\u5b9a\u503c\uff0c\u4e0d\u9002\u7528\u4e0e hash \u8d1f\u8f7d\u5747\u8861\u3001\u968f\u673a\u8d1f\u8f7d\u5747\u8861 \u5982\u679c\u5728 upstream \u4e2d\u53ea\u6709\u4e00\u53f0 server\uff0c\u5219\u8be5\u53c2\u6570\u5931\u6548\uff08\u5546\u4e1a\u7248\u624d\u6709\uff09\n\n`down`\uff1a\u7981\u6b62\u8bbf\u95ee\n\n`backup`\uff1a\u5907\u7528\u673a \u53ea\u6709\u5728\u5176\u4ed6\u670d\u52a1\u5668\u65e0\u6cd5\u8bbf\u95ee\u7684\u65f6\u5019\u624d\u80fd\u8bbf\u95ee\u5230 \u4e0d\u9002\u7528\u4e0e hash \u8d1f\u8f7d\u5747\u8861\u3001\u968f\u673a\u8d1f\u8f7d\u5747\u8861\n\n`max_fails`\uff1a\u8868\u793a\u5931\u8d25\u51e0\u6b21\uff0c\u5219\u6807\u8bb0 server \u5df2\u5b95\u673a\uff0c\u5254\u51fa\u4e0a\u6e38\u670d\u52a1 \u9ed8\u8ba4\u503c 1\n\n`fail_timeout`\uff1a\u8868\u793a\u5931\u8d25\u7684\u91cd\u8bd5\u65f6\u95f4 \u9ed8\u8ba4\u503c 10\n\n### 1\u3001keepalived\n\n```shell\nupstream [proxyName] {\n    server 192.168.1.173:8080 weight=1;\n    server 192.168.1.174:8080 weight=5;\n    server 192.168.1.175:8080 weight=2;\n    keepalive 32; #\u4fdd\u6301\u7684\u8fde\u63a5\u6570\n}\nserver {\n    listem  80;\n    server_name www.tomcats.com;    location / {\n        proxy_pass http://tomcats;\n        proxy_http_version 1.1; #\u8fde\u63a5\u7684\u534f\u8bae\u7248\u672c\n        proxy_set_header Connection ''; \u6e05\u7a7a\u8fde\u63a5\u8bf7\u6c42\u5934\n    }\n}\n```\n\n### 2\u3001\u63a7\u5236\u6d4f\u89c8\u5668\u7f13\u5b58\n\n```shell\nserver {\n    listem  80;\n    server_name www.tomcats.com;\n\n    location / {\n        proxy_pass http://tomcats;\n               expires 10s;  #\u6d4f\u89c8\u5668\u7f13\u5b5810\u79d2\u949f\n               #expires @22h30m  #\u5728\u665a\u4e0a10\u70b930\u7684\u65f6\u5019\u8fc7\u671f\n               #expires -1h  #\u7f13\u5b58\u5728\u4e00\u5c0f\u65f6\u524d\u65f6\u6548\n               #expires epoch  #\u4e0d\u8bbe\u7f6e\u7f13\u5b58\n               #expires off  #\u7f13\u5b58\u5173\u95ed\uff0c\u6d4f\u89c8\u5668\u81ea\u5df1\u63a7\u5236\u7f13\u5b58\n               #expires max  #\u6700\u5927\u8fc7\u671f\u65f6\u95f4\n    }\n}\n```\n\n### 3\u3001\u53cd\u5411\u4ee3\u7406\u7f13\u5b58\n\n```shell\nupstream [proxyName] {\n    server 192.168.1.173:8080 weight=1;\n    server 192.168.1.174:8080 weight=5;\n    server 192.168.1.175:8080 weight=2;\n}\n#proxy_cache_path \u8bbe\u7f6e\u7f13\u5b58\u4fdd\u5b58\u7684\u76ee\u5f55\u7684\u4f4d\u7f6e\n#keys_zone\u8bbe\u7f6e\u5171\u4eab\u5185\u4ee5\u53ca\u5360\u7528\u7684\u7a7a\u95f4\u5927\u5c0f\n#mas_size \u8bbe\u7f6e\u7f13\u5b58\u6700\u5927\u7a7a\u95f4\n#inactive \u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\uff0c\u9519\u8fc7\u6b64\u65f6\u95f4\u81ea\u52a8\u6e05\u7406\n#use_temp_path \u5173\u95ed\u96f6\u65f6\u76ee\u5f55\nproxy_cache_path /usr/local/nginx/upsteam_cache keys_zone=mycache:5m max_size=1g inactive=8h use_temp_path=off;\nserver {\n    listem  80;\n    server_name www.tomcats.com;\n    #\u5f00\u542f\u5e76\u4f7f\u7528\u7f13\u5b58\n    proxy_cache mycache;\n    #\u9488\u5bf9200\u548c304\u54cd\u5e94\u7801\u7684\u7f13\u5b58\u8fc7\u671f\u65f6\u95f4\n    proxy_cache_valid 200 304 8h;\n\n    location / {\n        proxy_pass http://tomcats;\n    }\n}\n```\n\n## \u4e94\u3001\u914d\u7f6e ssl \u8bc1\u4e66\u63d0\u4f9b https \u8bbf\u95ee\n\n### 1. \u5b89\u88c5 SSL \u6a21\u5757\n\n\u8981\u5728 nginx \u4e2d\u914d\u7f6e https\uff0c\u5c31\u5fc5\u987b\u5b89\u88c5 ssl \u6a21\u5757\uff0c\u4e5f\u5c31\u662f: `http_ssl_module`\u3002", "top": 0, "createdAt": 1746696521, "style": "", "script": "", "head": "", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "createdDate": "2025-05-08", "dateLabelColor": "#0969da"}}, "singeListJson": {}, "labelColorDict": {"bug": "#d73a4a", "documentation": "#0075ca", "duplicate": "#cfd3d7", "enhancement": "#a2eeef", "good first issue": "#7057ff", "help wanted": "#008672", "invalid": "#e4e669", "question": "#d876e3", "wontfix": "#ffffff"}, "displayTitle": "Blog Title", "faviconUrl": "https://github.githubassets.com/favicons/favicon.svg", "ogImage": "https://github.githubassets.com/favicons/favicon.svg", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "homeUrl": "https://mr-dzr.github.io/blogs", "prevUrl": "disabled", "nextUrl": "disabled"}